---
title: Linux系统性能监控
categories:
  - 工作
tags:
  - Linux
  - 系统性能
  - 监控告警
  - 云计算
date: 2023-06-04 22:27:08
---

系统性能，即操作系统完成计算任务的有效性、稳定性、安全性和响应速度，特别是在高并发的场景下，系统性能将会面临非常巨大的挑战，甚至造成业务崩溃乃至于经济损失的严重后果。Linux系统性能的影响因素有CPU、内存、磁盘IO、网络等，对这些指标进行监控，了解其变化趋势，就对整个系统的运行状态有了一个全局的掌控，从而可及时介入故障的处理，以保障业务的稳定性

# 1.CPU

CPU，操作系统稳定运行的根本，其速度与性能很大程度上决定了系统整体的性能，通常CPU数量越多、主频越高，服务器性能也就相对越好，衡量指标包括平均负载、CPU使用率、上下文切换、CPU缓存命中率等

## 1.1 平均负载

load average，平均负载，表示系统在1分钟、5分钟、15分钟内CPU负载的整体趋势，即指单位时间内系统处于可运行状态和不可中断状态的平均进程数，也即平均活跃进程数，与CPU使用率无关。其大小一般不大于系统CPU个数，否则将说明系统负载过高，可将单核CPU通俗地理解为单向行驶的公路桥，正在通行的车辆数为4时负载数为0.5，车辆数为8时负载为1，车辆数为12时负载为1.5，此时车辆通行已经需要排队

    # CPU个数
    [sword@engine ~]$ cat /proc/cpuinfo |grep cores|uniq
    cpu cores       : 2
    [sword@cloud-server ~]$ uptime 
    22:30:46 up 117 days, 49 min,  0 users,  load average: 0.56, 0.38, 0.38

- 注：平均负载一般大于CPU数量的70%的时候就应该排查高负载的原因，以免影响正常的业务运行

## 1.2 CPU使用率

# 2.内存

内存，加载进程数据供CPU运算，内存分配过小则进程将被阻塞，应用将变得缓慢，甚至失去响应，内存分配过大也将会导致资源的浪费

# 2.1 查询某用户系统负载

    top -u username

- 交互式命令：P，按%CPU使用率排序； T，按MITE+排行； M，按%MEM排行

# 2.2 以进程号查询某进程内存占用量

    pmap -d pid

# 2.3 某用户所有进程按内存占用量由大到小排序

    ps -e -o 'pid,comm,args,pcpu,rsz,vsz,stime,user,uid' | grep username |  sort -nrk5
    ps aux|head -1;ps aux|grep -(www.111cn.net)v PID|sort -rn -k +4|head

# 3.磁盘IO

磁盘I/O，内存与磁盘之间的输入输出操作，即程序读取本地文件将磁盘的数据拷贝到内存以及修改或创建本地文件把修改后的数据拷贝到磁盘的操作。由于磁盘的性能与CPU、内存的性能相差很大，所以磁盘IO也是制约程序性能的关键因素，毕竟程序所有的操作最后阶段几乎都是落盘。磁盘性能的衡量指标如下：

- 使用率，即磁盘处理I/O的时间百分比，过高的使用率通常意味着磁盘I/O存在性能瓶颈

- 饱和度，即磁盘处理I/O的繁忙程度，饱和度过高表示磁盘存在严重的性能瓶颈，达到100%时，磁盘将无法接受新的I/O请求

- IOPS，Input/Output Per Second，即磁盘每秒I/O请求数，数据库、大量小文件等这类随机读写比较多的场景可作为重要的衡量依据

- 吞吐量，即磁盘每秒的I/O请求大小，多媒体等顺序读写较多的场景可作为重要的衡量依据

- 响应时间，即I/O请求从发出到收到响应的间隔时间

## 3.1 磁盘IO

## 3.2 进程IO

# 4.网络

Linux运行的应用一般都基于网络，网络速度直接影响客户的感官，低速的、不稳定的网络将导致网络应用程序的访问阻塞，衡量指标如下：

- 带宽，表示链路的最大传输速率，单位通常为b/s，即比特/秒

- 吞吐量，表示单位时间内成功传输的数据量，单位为b/s或B/s，受带宽限制，吞吐量/带宽即是网络使用率

- 延时，表示从网络请求发出到收到远端响应所需时间，如TCP建立连接所需时间、RTT数据包往返所需时间等

- PPS，即Packet Per Second，表示以网络包为单位的传输速率，通常用于评估网络转发能力，如硬件交换机可以达到线性转发即PPS可以达到或者接近理论最大值，而Linux服务器的转发则易受网络包大小的影响

此外，网络的可用性（网络能否正常通信）、并发连接数（TCP连接数量）、丢包率（丢包百分比）、重传率（重新传输的网络包比例）等也是常用的性能指标

## 4.3 网络IO

网络IO，网卡与内存之间的输入输出，即程序接受网络数据时网卡将数据拷贝到内存以及程序发送网络数据时将数据从内存拷贝到网卡的操作



---------

# 参考文档

- https://mp.weixin.qq.com/s/5MhVQ3FJedVGAhIGycbs3g
- https://mp.weixin.qq.com/s/dTplQPAJweA5NEd8JmjGYA
- https://mp.weixin.qq.com/s/j69dSs6D4wauwem1qfIW8Q